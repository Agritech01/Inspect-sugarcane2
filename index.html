<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KBS Sugar - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° Data‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --kbs-green: #2E7D32; --kbs-orange: #FF9800; }
        body { font-family: 'Sarabun', sans-serif; background-color: #f4f7f6; }
        .kbs-header { background: linear-gradient(135deg, var(--kbs-green) 0%, #1565C0 100%); color: white; padding: 20px 0; border-bottom: 5px solid var(--kbs-orange); }
        .content-card { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .nav-pills .nav-link.active { background-color: var(--kbs-green); }
        .table thead { background-color: #f8f9fa; color: var(--kbs-green); }
    </style>
</head>
<body>

<div class="kbs-header mb-4">
    <div class="container d-flex align-items-center">
        <img src="https://i.postimg.cc/wMdZPmTL/skr-nch-xt-2026-01-12-092906.png" height="50" class="bg-white p-1 rounded me-3">
        <h1 class="h4 mb-0 fw-bold">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡∏π‡∏Å‡∏≠‡πâ‡∏≠‡∏¢ ‡∏õ‡∏µ 69/70 (Data‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à)</h1>
    </div>
</div>

<div class="container">
    <ul class="nav nav-pills mb-3 shadow-sm p-2 bg-white rounded">
        <li class="nav-item">
            <button class="nav-link active" onclick="changeTab('‡∏õ‡∏•‡∏π‡∏Å‡∏≠‡πâ‡∏≠‡∏¢‡πÉ‡∏ô‡∏ô‡∏≤ ‡∏õ‡∏µ 69/70', this)">üåæ ‡∏õ‡∏•‡∏π‡∏Å‡∏≠‡πâ‡∏≠‡∏¢‡πÉ‡∏ô‡∏ô‡∏≤</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" onclick="changeTab('‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏∑‡∏ä‡∏≠‡∏∑‡πà‡∏ô‡∏°‡∏≤‡∏õ‡∏•‡∏π‡∏Å‡∏≠‡πâ‡∏≠‡∏¢ ‡∏õ‡∏µ 69/70', this)">üîÑ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏∑‡∏ä‡∏≠‡∏∑‡πà‡∏ô</button>
        </li>
    </ul>

    <div class="content-card">
        <div id="loader" class="text-center p-5">
            <div class="spinner-border text-success mb-2"></div>
            <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets...</p>
        </div>

        <div class="table-responsive">
            <table class="table table-hover align-middle border">
                <thead>
                    <tr>
                        <th>‡πÄ‡∏•‡∏Ç‡πÅ‡∏õ‡∏•‡∏á</th>
                        <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏≤‡∏ß‡πÑ‡∏£‡πà (‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤)</th>
                        <th>‡πÄ‡∏Ç‡∏ï</th>
                        <th>‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏©‡∏ï‡∏£</th>
                        <th class="text-end">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (‡πÑ‡∏£‡πà)</th>
                        <th class="text-center">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏à‡πâ‡∏á
    const SHEET_ID = '2PACX-1vRY22UkMfLhAswqWJLCMvhCMeZxVsFQy1gLBLnrwB6VggruF4son8LZxN-EqtFxsUOdv1xs-Yf2cKnn';
    const GID = '1732816752'; 
    const CSV_URL = `https://docs.google.com/spreadsheets/d/e/${SHEET_ID}/pub?gid=${GID}&output=csv`;

    let rawData = [];
    let currentTab = '‡∏õ‡∏•‡∏π‡∏Å‡∏≠‡πâ‡∏≠‡∏¢‡πÉ‡∏ô‡∏ô‡∏≤ ‡∏õ‡∏µ 69/70';

    async function init() {
        try {
            const response = await fetch(CSV_URL);
            const text = await response.text();
            
            // ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î ‡πÅ‡∏•‡∏∞‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏≠‡∏°‡∏°‡∏≤
            const lines = text.split('\n').filter(l => l.trim() !== "");
            rawData = lines.map(line => line.split(',').map(v => v.trim().replace(/"/g, '')));

            document.getElementById('loader').classList.add('d-none');
            render();
        } catch (err) {
            document.getElementById('tableBody').innerHTML = `<tr><td colspan="6" class="text-center text-danger">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</td></tr>`;
        }
    }

    function render() {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';
        
        const headers = rawData[0]; // ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        
        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏Å‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì: ‡∏´‡∏≤ Index ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ---
        const getIdx = (name) => headers.findIndex(h => h.includes(name));
        
        const iIntech = getIdx("‡πÄ‡∏•‡∏Ç‡πÅ‡∏õ‡∏•‡∏áintech");
        const iQuota = getIdx("‡πÄ‡∏•‡∏Ç‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤");
        const iFarmer = getIdx("‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏≤‡∏ß‡πÑ‡∏£‡πà");
        const iZone = getIdx("‡πÄ‡∏Ç‡∏ï");
        const iStaff = getIdx("‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏©‡∏ï‡∏£");
        const iArea = getIdx("‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà");
        const iStatus = getIdx("‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£"); // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏¢‡∏Å‡πÅ‡∏ó‡πá‡∏ö
        const iAudit = getIdx("‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£");

        // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 1 (‡∏Ç‡πâ‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á)
        const rows = rawData.slice(1);
        let count = 0;

        rows.forEach(row => {
            // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ‡∏ñ‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£' ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            if (row[iStatus] === currentProject) {
                count++;
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="fw-bold text-primary">${row[iIntech] || '-'}</td>
                    <td><b>${row[iFarmer] || '-'}</b><br><small class="text-muted">${row[iQuota] || '-'}</small></td>
                    <td class="text-center">${row[iZone] || '-'}</td>
                    <td>${row[iStaff] || '-'}</td>
                    <td class="text-end fw-bold">${parseFloat(row[iArea] || 0).toFixed(2)}</td>
                    <td class="text-center">
                        <span class="badge ${row[iAudit] === '‡∏ú‡πà‡∏≤‡∏ô' ? 'bg-success' : 'bg-warning text-dark'}">
                            ${row[iAudit] || '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à'}
                        </span>
                    </td>
                `;
                tbody.appendChild(tr);
            }
        });

        if (count === 0) {
            tbody.innerHTML = `<tr><td colspan="6" class="text-center p-5 text-muted">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç "${currentProject}"</td></tr>`;
        }
    }

    function changeTab(name, btn) {
        currentProject = name;
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        btn.classList.add('active');
        render();
    }

    init();
</script>
</body>
</html>
