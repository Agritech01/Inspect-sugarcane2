<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KBS Sugar - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° Data‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à 69/70</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --kbs-green: #2E7D32; --kbs-orange: #FF9800; --bg-light: #F4F7F6; }
        body { font-family: 'Sarabun', sans-serif; background-color: var(--bg-light); }
        .kbs-header { background: linear-gradient(135deg, var(--kbs-green) 0%, #1565C0 100%); color: white; padding: 20px 0; border-bottom: 5px solid var(--kbs-orange); }
        .nav-tabs-kbs .nav-link { border: none; background: #e9ecef; color: #666; border-radius: 10px; padding: 10px 20px; font-weight: 600; margin-right: 5px; }
        .nav-tabs-kbs .nav-link.active { background: var(--kbs-green); color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .content-card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        .loading-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: white; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    </style>
</head>
<body>

<div id="loader" class="loading-overlay">
    <div class="spinner-border text-success mb-2"></div>
    <div class="fw-bold text-success">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
</div>

<div class="kbs-header mb-4">
    <div class="container d-flex align-items-center">
        <img src="https://i.postimg.cc/wMdZPmTL/skr-nch-xt-2026-01-12-092906.png" height="50" class="bg-white p-1 rounded me-3 shadow-sm">
        <h1 class="h4 mb-0 fw-bold">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡∏π‡∏Å‡∏≠‡πâ‡∏≠‡∏¢ ‡∏õ‡∏µ 69/70</h1>
    </div>
</div>

<div class="container">
    <ul class="nav nav-tabs nav-tabs-kbs border-0 mb-3" id="tabMenu">
        <li class="nav-item">
            <button class="nav-link active" onclick="filterProject('‡∏õ‡∏•‡∏π‡∏Å‡∏≠‡πâ‡∏≠‡∏¢‡πÉ‡∏ô‡∏ô‡∏≤ ‡∏õ‡∏µ 69/70', this)">‡∏õ‡∏•‡∏π‡∏Å‡∏≠‡πâ‡∏≠‡∏¢‡πÉ‡∏ô‡∏ô‡∏≤ 69/70</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" onclick="filterProject('‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏∑‡∏ä‡∏≠‡∏∑‡πà‡∏ô‡∏°‡∏≤‡∏õ‡∏•‡∏π‡∏Å‡∏≠‡πâ‡∏≠‡∏¢ ‡∏õ‡∏µ 69/70', this)">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏∑‡∏ä‡∏≠‡∏∑‡πà‡∏ô 69/70</button>
        </li>
    </ul>

    <div class="content-card">
        <div class="d-md-flex justify-content-between align-items-center mb-3">
            <div class="col-md-5">
                <input type="text" id="searchInput" onkeyup="searchTable()" class="form-control" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡∏ä‡∏∑‡πà‡∏≠/‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤/‡πÄ‡∏•‡∏Ç‡πÅ‡∏õ‡∏•‡∏á...">
            </div>
            <div id="statusInfo" class="text-muted small mt-2 mt-md-0"></div>
        </div>

        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>‡πÄ‡∏•‡∏Ç‡πÅ‡∏õ‡∏•‡∏á</th>
                        <th>‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤ / ‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏≤‡∏ß‡πÑ‡∏£‡πà</th>
                        <th class="text-center">‡πÄ‡∏Ç‡∏ï</th>
                        <th>‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏©‡∏ï‡∏£</th>
                        <th class="text-end">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (‡πÑ‡∏£‡πà)</th>
                        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏π‡∏Å</th>
                        <th class="text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const SHEET_ID = '2PACX-1vRY22UkMfLhAswqWJLCMvhCMeZxVsFQy1gLBLnrwB6VggruF4son8LZxN-EqtFxsUOdv1xs-Yf2cKnn';
    const GID = '1732816752'; // GID ‡∏Ç‡∏≠‡∏á‡∏ä‡∏µ‡∏ó Data‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à
    const URL = `https://docs.google.com/spreadsheets/d/e/${SHEET_ID}/pub?gid=${GID}&output=csv`;

    let allRows = [];
    let colIndex = {};
    let currentProject = '‡∏õ‡∏•‡∏π‡∏Å‡∏≠‡πâ‡∏≠‡∏¢‡πÉ‡∏ô‡∏ô‡∏≤ ‡∏õ‡∏µ 69/70';

    async function fetchData() {
        try {
            const response = await fetch(URL);
            const data = await response.text();
            const lines = data.split('\n').filter(l => l.trim() !== "");
            
            // 1. ‡πÄ‡∏Å‡πá‡∏ö‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á (Headers)
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            
            // 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå (‡πÄ‡∏•‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö Logic findColumnIndex ‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏Å‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì)
            const getIdx = (keywords) => headers.findIndex(h => keywords.some(k => h.includes(k)));

            colIndex = {
                intech: getIdx(['‡πÄ‡∏•‡∏Ç‡πÅ‡∏õ‡∏•‡∏áintech', 'Intech']),
                quota: getIdx(['‡πÄ‡∏•‡∏Ç‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤', '‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤']),
                farmer: getIdx(['‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏≤‡∏ß‡πÑ‡∏£‡πà', '‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•']),
                zone: getIdx(['‡πÄ‡∏Ç‡∏ï']),
                staff: getIdx(['‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏©‡∏ï‡∏£', '‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏©‡∏ï‡∏£']),
                area: getIdx(['‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà']),
                date: getIdx(['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏π‡∏Å']),
                projectStatus: getIdx(['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£']),
                auditCondition: getIdx(['‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£', '‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à'])
            };

            // 3. ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÅ‡∏ñ‡∏ß
            allRows = lines.slice(1).map(line => line.split(',').map(v => v.trim().replace(/"/g, '')));

            document.getElementById('loader').style.display = 'none';
            render();
        } catch (e) {
            console.error(e);
            alert("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£ Publish CSV");
        }
    }

    function render() {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';
        
        // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏° "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£"
        const filtered = allRows.filter(row => row[colIndex.projectStatus] === currentProject);
        document.getElementById('statusInfo').innerText = `‡∏û‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${filtered.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;

        filtered.forEach(row => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td class="fw-bold text-primary">${row[colIndex.intech] || '-'}</td>
                <td>
                    <div class="fw-bold">${row[colIndex.farmer] || '-'}</div>
                    <div class="small text-muted">‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤: ${row[colIndex.quota] || '-'}</div>
                </td>
                <td class="text-center"><span class="badge bg-secondary">${row[colIndex.zone] || '-'}</span></td>
                <td>${row[colIndex.staff] || '-'}</td>
                <td class="text-end fw-bold">${parseFloat(row[colIndex.area] || 0).toFixed(2)}</td>
                <td class="small">${row[colIndex.date] || '-'}</td>
                <td class="text-center">
                    <span class="badge ${row[colIndex.auditCondition] === '‡∏ú‡πà‡∏≤‡∏ô' ? 'bg-success' : 'bg-warning text-dark'}">
                        ${row[colIndex.auditCondition] || '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à'}
                    </span>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }

    function filterProject(name, btn) {
        currentProject = name;
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        btn.classList.add('active');
        render();
    }

    function searchTable() {
        const q = document.getElementById('searchInput').value.toLowerCase();
        const rows = document.querySelectorAll('#tableBody tr');
        rows.forEach(r => r.style.display = r.innerText.toLowerCase().includes(q) ? '' : 'none');
    }

    fetchData();
</script>
</body>
</html>
