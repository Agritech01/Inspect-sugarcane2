<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบติดตามข้อมูลการตรวจโครงการ 69/70</title>
    <style>
        body { font-family: 'Tahoma', sans-serif; background-color: #f4f7f6; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; text-align: center; }
        .nav-tabs { display: flex; justify-content: center; margin-bottom: 20px; border-bottom: 2px solid #ddd; }
        .tab { padding: 10px 20px; cursor: pointer; border: none; background: none; font-size: 16px; font-weight: bold; }
        .tab.active { color: #27ae60; border-bottom: 3px solid #27ae60; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #27ae60; color: white; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .loading { text-align: center; padding: 20px; font-style: italic; color: #666; }
    </style>
</head>
<body>

<div class="container">
    <h1>ข้อมูลการตรวจโครงการ ปี 69/70</h1>
    
    <div class="nav-tabs">
        <button class="tab active" onclick="switchPage('ปลูกอ้อยในนา')">ปลูกอ้อยในนา ปี 69/70</button>
        <button class="tab" onclick="switchPage('เปลี่ยนพืชอื่นมาปลูกอ้อย')">เปลี่ยนพืชอื่นมาปลูกอ้อย ปี 69/70</button>
    </div>

    <div id="content">
        <div class="loading">กำลังโหลดข้อมูล...</div>
        <table id="dataTable" style="display:none;">
            <thead>
                <tr id="tableHeader"></tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<script>
    // URL สำหรับดึงข้อมูล (แปลงจาก pubhtml เป็น export?format=csv)
    const sheetID = "2PACX-1vRY22UkMfLhAswqWJLCMvhCMeZxVsFQy1gLBLnrwB6VggruF4son8LZxN-EqtFxsUOdv1xs-Yf2cKnn";
    const gidProject = "742878785"; // Dataโครงการ
    const gidCheck = "1732816752";   // Dataการตรวจ
    
    // แปลงลิงก์เพื่อให้ดึงข้อมูลดิบได้ง่ายขึ้น
    const csvUrl = `https://docs.google.com/spreadsheets/d/e/${sheetID}/pub?gid=${gidCheck}&output=csv`;

    let allData = [];

    async function fetchData() {
        try {
            const response = await fetch(csvUrl);
            const data = await response.text();
            allData = parseCSV(data);
            switchPage('ปลูกอ้อยในนา'); // โหลดหน้าแรกหลังจากดึงข้อมูลเสร็จ
        } catch (error) {
            document.getElementById('content').innerHTML = "เกิดข้อผิดพลาดในการดึงข้อมูล";
            console.error(error);
        }
    }

    function parseCSV(csvText) {
        const lines = csvText.split("\n");
        const headers = lines[0].split(",").map(h => h.trim());
        return lines.slice(1).map(line => {
            const values = line.split(",").map(v => v.trim());
            return headers.reduce((obj, header, i) => {
                obj[header] = values[i];
                return obj;
            }, {});
        });
    }

    function switchPage(statusFilter) {
        // จัดการ UI Tabs
        document.querySelectorAll('.tab').forEach(btn => {
            btn.classList.toggle('active', btn.innerText.includes(statusFilter));
        });

        const tableBody = document.getElementById('tableBody');
        const tableHeader = document.getElementById('tableHeader');
        const table = document.getElementById('dataTable');
        
        tableBody.innerHTML = "";
        tableHeader.innerHTML = "";

        // กรองข้อมูลตาม "สถานะโครงการ" (คอลัมน์ที่คุณระบุ)
        const filteredData = allData.filter(row => row['สถานะโครงการ'] === statusFilter);

        if (filteredData.length > 0) {
            // สร้างหัวตาราง
            const headers = Object.keys(filteredData[0]);
            headers.forEach(h => {
                const th = document.createElement('th');
                th.innerText = h;
                tableHeader.appendChild(th);
            });

            // ใส่ข้อมูลในตาราง
            filteredData.forEach(row => {
                const tr = document.createElement('tr');
                headers.forEach(h => {
                    const td = document.createElement('td');
                    td.innerText = row[h] || "-";
                    tr.appendChild(td);
                });
                tableBody.appendChild(tr);
            });

            table.style.display = "table";
            document.querySelector('.loading').style.display = "none";
        } else {
            table.style.display = "none";
            document.querySelector('.loading').innerText = "ไม่พบข้อมูลในหมวดหมู่นี้";
            document.querySelector('.loading').style.display = "block";
        }
    }

    // เริ่มทำงาน
    fetchData();
</script>

</body>
</html>
